@using AttendanceManagementSystem.Models
@{
    ViewData["Title"] = "Teacher Dashboard";
    var todayClasses = ViewBag.TodayClasses as List<TimeTable>;
}

<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-info border-0 shadow-sm">
            <h4 class="alert-heading">
                <i class="bi bi-person-badge me-2"></i>
                Welcome, @ViewBag.TeacherName!
            </h4>
            <p class="mb-0">Today is @DateTime.Now.ToString("dddd, MMMM dd, yyyy")</p>
        </div>
    </div>
</div>

<!-- Today's Classes -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="card-title mb-0">
                    <i class="bi bi-calendar-check text-primary me-2"></i>
                    Today's Classes (@DateTime.Now.DayOfWeek)
                </h5>
            </div>
            <div class="card-body">
                @if (todayClasses != null && todayClasses.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Course</th>
                                    <th>Section</th>
                                    <th>Room</th>
                                    <th>Status</th>
                                    <th class="text-end">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var classItem in todayClasses)
                                {
                                    var currentTime = DateTime.Now.TimeOfDay;
                                    var isCurrentClass = currentTime >= classItem.StartTime && currentTime <= classItem.EndTime;
                                    var isUpcoming = currentTime < classItem.StartTime;
                                    var isPast = currentTime > classItem.EndTime;

                                    <tr class="@(isCurrentClass ? "table-success" : "")">
                                        <td>
                                            <strong>@classItem.StartTime.ToString(@"hh\:mm")</strong> - 
                                            @classItem.EndTime.ToString(@"hh\:mm")
                                        </td>
                                        <td>
                                            <strong>@classItem.Course?.CourseName</strong>
                                            <br />
                                            <small class="text-muted">@classItem.Course?.CourseCode</small>
                                        </td>
                                        <td>@classItem.Section?.Name</td>
                                        <td>
                                            <span class="badge bg-info">
                                                <i class="bi bi-geo-alt"></i>
                                                @(string.IsNullOrEmpty(classItem.RoomNumber) ? "N/A" : classItem.RoomNumber)
                                            </span>
                                        </td>
                                        <td>
                                            @if (isCurrentClass)
                                            {
                                                <span class="badge bg-success">
                                                    <i class="bi bi-clock"></i> In Progress
                                                </span>
                                            }
                                            else if (isUpcoming)
                                            {
                                                <span class="badge bg-warning">
                                                    <i class="bi bi-hourglass-split"></i> Upcoming
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary">
                                                    <i class="bi bi-check-circle"></i> Completed
                                                </span>
                                            }
                                        </td>
                                        <td class="text-end">
                                            <a asp-controller="Attendance" 
                                               asp-action="MarkByCourse" 
                                               asp-route-courseId="@classItem.CourseId" 
                                               asp-route-sectionId="@classItem.SectionId"
                                               class="btn btn-sm @(isCurrentClass ? "btn-success" : "btn-outline-primary")">
                                                <i class="bi bi-check2-square"></i>
                                                Mark Attendance
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-5">
                        <i class="bi bi-calendar-x text-muted" style="font-size: 4rem;"></i>
                        <p class="text-muted mt-3 mb-0">No classes scheduled for today</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="bi bi-calendar-check text-primary" style="font-size: 3rem;"></i>
                </div>
                <h5 class="card-title">Mark Attendance</h5>
                <p class="card-text text-muted">Take attendance for your classes</p>
                <a asp-controller="Attendance" asp-action="Mark" class="btn btn-primary">
                    Go to Attendance
                </a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="bi bi-clock-history text-success" style="font-size: 3rem;"></i>
                </div>
                <h5 class="card-title">View History</h5>
                <p class="card-text text-muted">Check attendance records</p>
                <a asp-controller="Attendance" asp-action="Index" class="btn btn-success">
                    View Records
                </a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="bi bi-calendar-week text-info" style="font-size: 3rem;"></i>
                </div>
                <h5 class="card-title">My Timetable</h5>
                <p class="card-text text-muted">View your weekly schedule</p>
                <a asp-controller="TimeTables" asp-action="Index" class="btn btn-info">
                    View Timetable
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Weekly Schedule Overview -->
<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="card-title mb-0">
                    <i class="bi bi-calendar-week text-info me-2"></i>
                    This Week's Schedule
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-light border">
                    <i class="bi bi-info-circle me-2"></i>
                    <small>Check your full weekly schedule in the Timetable section</small>
                </div>
                <div class="text-center py-4">
                    <a asp-controller="TimeTables" asp-action="Index" class="btn btn-lg btn-outline-primary">
                        <i class="bi bi-calendar3"></i>
                        View Complete Timetable
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-refresh page every 5 minutes to update current class status
        setTimeout(function() {
            location.reload();
        }, 300000); // 5 minutes

        // Highlight current time slot
        $(document).ready(function() {
            console.log('Teacher Dashboard Loaded');
            
            // Add pulse animation to current class
            $('.table-success').addClass('animate__animated animate__pulse');
        });
    </script>
}
